---
import Layout from "../../layouts/Layout.astro";
import OffreCard from "../../components/OffreCard.astro";
import { getOffres } from "../../js/backend.mjs";

// ðŸ”¥ donnÃ©es venant de PocketBase
const offres = await getOffres();
---

<Layout titre="Offres">
    <h1 class="text-3xl font-bold mb-6">Nos offres</h1>

    <!-- BOUTONS -->
    <div class="flex gap-4 mb-8">
        <!-- Bouton lien vers la route dynamique surface -->
        <a
            href="/offres/surface/80"
            role="button"
            class="rounded-full px-6 py-3 bg-slate-800 text-white text-center"
        >
            Maisons de plus de 80 mÂ²
        </a>

        <!-- Bouton filtre favoris -->
        <button
            id="favori-button"
            class="rounded-full px-6 py-3 bg-slate-600 text-white"
        >
            Afficher les favoris
        </button>
    </div>

    <!-- LISTE DES OFFRES -->
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {offres.map((offre) => <OffreCard offre={offre} />)}
    </div>

    <!-- SCRIPT FAVORIS -->
    <script>
        const button = document.getElementById("favori-button");
        let showOnlyFavorites = false;

        button?.addEventListener("click", () => {
            showOnlyFavorites = !showOnlyFavorites;
            const offres = document.querySelectorAll(".offre");

            offres.forEach((offre) => {
                const isFavori = offre.dataset.favori === "true";

                if (showOnlyFavorites) {
                    offre.style.display = isFavori ? "block" : "none";
                    button.textContent = "Afficher tout";
                } else {
                    offre.style.display = "block";
                    button.textContent = "Afficher les favoris";
                }
            });
        });
    </script>
</Layout>
